{% extends "base.html" %}
{% block title %}Your Tasks | Personal Task Manager{% endblock %}

{% block content %}
<div class="card glass">
  <div class="header-row">
    <h2>Your Tasks</h2>
    <a href="{{ url_for('add_task') }}" class="btn btn-add">+ Add Task</a>
  </div>

  {% if tasks %}
  <table class="table">
    <thead>
      <tr>
        <th>Task</th>
        <th>Due Date</th>
        <th>Days Remaining</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      {# determine deadline state: urgent (<1), soon (1..3), ok (>3) #}
      {% set state = 'urgent' if task.days_left < 1 else ('soon' if task.days_left <= 3 else 'ok') %}

      <tr class="row-accent deadline-{{ state }}">
        <td>
          <div class="title">
            {{ task.title }}
            <span class="priority-pill {{ task.priority|lower }}">{{ task.priority }}</span>
          </div>
          {% if task.description %}
          <div class="muted">{{ task.description }}</div>
          {% endif %}
        </td>

        <td>{{ task.deadline.strftime('%Y-%m-%d') }}</td>

        <td>
          {% if task.days_left < 0 %}
            <span class="due due-urgent">Overdue {{ (task.days_left|abs) }}d</span>
          {% elif task.days_left == 0 %}
            <span class="due due-urgent">Due today</span>
          {% elif task.days_left <= 3 %}
            <span class="due due-soon">{{ task.days_left }} day{% if task.days_left != 1 %}s{% endif %}</span>
          {% else %}
            <span class="due due-ok">{{ task.days_left }} days</span>
          {% endif %}
        </td>

        <td class="actions">
          <a href="{{ url_for('complete_task', task_id=task.id) }}" class="btn btn-green">Mark Complete</a>
          <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn btn-blue">Edit</a>
          <a href="{{ url_for('delete_task', task_id=task.id) }}"
           class="btn btn-red btn-delete"
           data-id="{{ task.id }}">Delete</a>

        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">No tasks yet. Click “Add Task”.</p>
  {% endif %}
</div>
{% endblock %}
